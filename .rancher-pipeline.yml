stages:
- name: build
  steps:
  - runScriptConfig:
      image: golang:1.11
      shellScript: |-
        mkdir -p /go/src
        ln -s `pwd` /go/src/lingwei
        cd /go/src/lingwei
        CGO_ENABLED=1 GOOS=windows GOARCH=amd64 go build -o lingwei main.go
- name: publish
  steps:
  - publishImageConfig:
      dockerfilePath: ./Dockerfile
      buildContext: .
      tag: lingwei
      pushRemote: true
      registry: dev.rancher.com:31117
    env:
      PLUGIN_DEBUG: "true"
  - publishCatalogConfig:
      path: ./charts/lingwei/latest
      catalogTemplate: lingwei
      version: latest
      gitUrl: https://github.com/aceyu/charts.git
      gitBranch: master
      gitAuthor: zac
      gitEmail: cydiay@gmail.com
    envFrom:
    - sourceName: github
      sourceKey: USERNAME
      targetKey: USERNAME
    - sourceName: github
      sourceKey: PASSWORD
      targetKey: PASSWORD
timeout: 60
notification: {}
